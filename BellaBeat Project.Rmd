---
title: "Bellabeat Data Analysis Project"
author: "Sérgio Teixeira"
date: "2024-07-05"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

# Bellabeat Data Analysis Project

## 1- Ask

## Introduction

Bellabeat is a high-tech company that manufactures health-focused smart products aimed at women. Bellabeat products collect a wealth of data that can provide deep insights into user behavior and wellness trends. This project aims to analyze user data from smart devices to uncover patterns and provide actionable recommendations for enhancing user experience and engagement.

Understanding activity patterns is crucial for Bellabeat as it can help in developing better marketing strategies, creating more personalized product offerings, and ultimately improving the health and wellness of its target audience.

## Objective

The primary objective of this analysis is to understand the physical activity patterns of users of smart devices. Specifically, we aim to:

1.  **Identify User Segments**: Segment users based on their activity levels (active, moderately active, inactive).
2.  **Analyze Activity Patterns**: Examine how activity levels vary by time of day, day of the week, and other relevant factors.
3.  **Provide Recommendations**: Develop targeted marketing and engagement strategies based on the insights gained from the data.

## 2- Prepare

### Download Database

<https://www.kaggle.com/datasets/arashnic/fitbit>

### About Dataset

#### Content

This dataset generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. Individual reports can be parsed by export session ID (column A) or timestamp (column B). Variation between output represents use of different types of Fitbit trackers and individual tracking behaviors / preferences.

### Installing Packages

```{r}
install.packages("vroom")
install.packages("tidyverse")
install.packages("readxl")
install.packages("lubridate")
# Colorblind-Friendly Color Maps
install.packages("viridis")
```

### Loading Packages

```{r}
library(readxl)
library(tidyverse)
library(lubridate)
library(dplyr)
library(ggplot2)
library(tidyr)
library(vroom)
library(viridis)
```

# 3- Process

### Cleaning Data

#### Loading Heartrate CSV file(too large) using vroom

```{r}
heartrate <- vroom("C:/Users/sergio/Desktop/Case_Studies_Google/heartrate_seconds_merged.csv")
```

```{r}
activity <- read.csv("C:/Users/sergio/Desktop/Case_Studies_Google/Fitabase Data 4.12.16-5.12.16/dailyActivity_merged.csv")
calories <- read.csv("C:/Users/sergio/Desktop/Case_Studies_Google/Fitabase Data 4.12.16-5.12.16/hourlyCalories_merged.csv")
intensities <- read.csv("C:/Users/sergio/Desktop/Case_Studies_Google/Fitabase Data 4.12.16-5.12.16/hourlyIntensities_merged.csv")
sleep <- read.csv("C:/Users/sergio/Desktop/Case_Studies_Google/Fitabase Data 4.12.16-5.12.16/sleepDay_merged.csv")
weight <- read.csv("C:/Users/sergio/Desktop/Case_Studies_Google/Fitabase Data 4.12.16-5.12.16/weightLogInfo_merged.csv")
```

### Date Formatting

In this case, I am creating two new columns for the date and time, which facilitates the manipulation and analysis of the dates. These operations can be useful for preparing the data for temporal analyses, aggregations by date or time, and for visualizing activity patterns over time.

```{r}
# intensities
intensities$ActivityHour=as.POSIXct(intensities$ActivityHour, format="%m/%d/%Y %I:%M:%S %p", tz=Sys.timezone())
intensities$time <- format(intensities$ActivityHour, format = "%H:%M:%S")
intensities$date <- format(intensities$ActivityHour, format = "%m/%d/%y")
# calories
calories$ActivityHour=as.POSIXct(calories$ActivityHour, format="%m/%d/%Y %I:%M:%S %p", tz=Sys.timezone())
calories$time <- format(calories$ActivityHour, format = "%H:%M:%S")
calories$date <- format(calories$ActivityHour, format = "%m/%d/%y")
# heartrate
heartrate$Time=as.POSIXct(heartrate$Time, format="%m/%d/%Y %I:%M:%S %p", tz=Sys.timezone())
heartrate$time <- format(heartrate$Time, format = "%H:%M:%S")
heartrate$date <- format(heartrate$Time, format = "%m/%d/%y")
# activity
activity$ActivityDate=as.POSIXct(activity$ActivityDate, format="%m/%d/%Y", tz=Sys.timezone())
activity$date <- format(activity$ActivityDate, format = "%m/%d/%y")
# sleep
sleep$SleepDay=as.POSIXct(sleep$SleepDay, format="%m/%d/%Y %I:%M:%S %p", tz=Sys.timezone())
sleep$date <- format(sleep$SleepDay, format = "%m/%d/%y")
```

### General Statistics

```{r}
# activity
activity %>%  
  select(TotalSteps,
         TotalDistance,
         SedentaryMinutes) %>%
  summary()

# explore num of active minutes per category
activity %>%
  select(VeryActiveMinutes, FairlyActiveMinutes, LightlyActiveMinutes) %>%
  summary()

# calories
calories %>%
  select(Calories) %>%
  summary()

# heartrate
heartrate%>%
  rename(heartrate = Value) %>%
  select(heartrate) %>%
  summary()

# sleep
sleep %>%
  select(TotalSleepRecords, TotalMinutesAsleep, TotalTimeInBed) %>%
  summary()

# weight
weight %>%
  select(WeightKg, BMI) %>%
  summary()
```

The summary statistics reveal several important insights about user behaviors and health metrics. On average, users take around 7,638 steps daily, covering approximately 5.49 kilometers. Despite this, users spend a significant amount of time sedentary, with a mean of 991.2 minutes per day.

Activity intensity data shows that users engage in very active minutes for an average of 21.16 minutes per day, fairly active minutes for 13.56 minutes, and lightly active minutes for 192.8 minutes. Caloric expenditure averages 97.39 calories, with significant variability observed.

Heartrate data indicates a mean value of 77.33 beats per minute, suggesting moderate cardiovascular activity. Sleep patterns reveal that users have an average of 1.119 sleep records per day, with a mean total sleep time of 419.5 minutes and total time in bed of 458.6 minutes.

Lastly, the average weight of users is 72.04 kg, with a mean BMI of 25.19, indicating that, on average, users fall into the overweight category according to BMI standards. These insights can help guide targeted health and wellness strategies.

### Summarize Data

```{r}
cat("Number of distinct IDs in activity: ", n_distinct(activity$Id), "\n")
cat("Number of distinct IDs in calories: ", n_distinct(calories$Id), "\n")
cat("Number of distinct IDs in heartrate: ", n_distinct(heartrate$Id), "\n")
cat("Number of distinct IDs in intensities: ", n_distinct(intensities$Id), "\n")
cat("Number of distinct IDs in sleep: ", n_distinct(sleep$Id), "\n")
cat("Number of distinct IDs in weight: ", n_distinct(weight$Id), "\n")

```

It is true that we have some limitations in terms of the number of IDs, particularly for the weight and heartrate datasets. However, it is still possible to extract valuable insights. Focusing on correlations between different data sets and segmenting analyses can help mitigate some of these limitations.

# 4 & 5 - Analyze and Share

# Analysis of Physical Activity Data for Bellabeat

```         
```

```{r}
activity <- activity %>%
  mutate(TotalActiveMinutes = VeryActiveMinutes + FairlyActiveMinutes)

# Classificar os dias
activity <- activity %>%
  mutate(ActivityLevel = case_when(
    TotalActiveMinutes == 0 ~ "NoActive (0 minutes)",
    TotalActiveMinutes < 30 ~ "FairlyActive (less than 30 minutes)",
    TotalActiveMinutes >= 30 ~ "Active (more than 30 minutes)"
  ))

# Calcular as percentagens
activity_level_counts <- activity %>%
  count(ActivityLevel) %>%
  mutate(percentage = n / sum(n) * 100)

# Criar o gráfico tipo donut
ggplot(activity_level_counts, aes(x = 2, y = percentage, fill = ActivityLevel)) +
  geom_bar(stat = "identity", color = "white") +
  coord_polar(theta = "y", start = 0) +
  xlim(0.5, 2.5) +
  theme_void() +
  theme(legend.position = "bottom",
        plot.title = element_text(hjust = 0.5, size = 14, face = "bold")) +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), 
            position = position_stack(vjust = 0.5)) +
  labs(title = "Days classified by time of physical activity") +
  scale_fill_manual(values = c("Active (more than 30 minutes)" = "#66c2a5", 
                               "FairlyActive (less than 30 minutes)" = "#fc8d62", 
                               "NoActive (0 minutes)" = "#8da0cb")) +
  guides(fill = guide_legend(title = NULL, nrow = 1, byrow = TRUE))
```

## Summary of Insights:

### Distribution of Activity Levels

-   **Active (\>30 minutes)**: 42.6% of days.
-   **Moderately Active (\<30 minutes)**: 17.5% of days.
-   **Inactive (0 minutes)**: 39.9% of days.

### General Trends

-   Almost 40% of days show no significant physical activity (0 minutes).
-   Approximately 60% of days show some physical activity, with a large proportion being classified as "Active" (\>30 minutes).

### Comparison between Moderate and High Activity

-   The percentage of days with moderate activity (\<30 minutes) is significantly lower than the percentage of days with high activity (\>30 minutes).

## Analysis of Sleep and Activity Levels

```{r}
# Merge sleep, activity, and intensities datasets by 'Id' and 'date'
merged_data <- merge(sleep, activity, by=c('Id', 'date'))
merged_data <- merge(merged_data, intensities, by=c('Id', 'date'))

# Reclassify sleep data into categories
merged_data <- merged_data %>%
  mutate(SleepCategory = case_when(
    TotalMinutesAsleep < 360 ~ "Insufficient Sleep",
    TotalMinutesAsleep >= 360 & TotalMinutesAsleep <= 540 ~ "Adequate Sleep",
    TotalMinutesAsleep > 540 ~ "Excessive Sleep"
  ))

# Reclassify activity levels in the merged_data table
merged_data <- merged_data %>%
  mutate(TotalActiveMinutes = VeryActiveMinutes + FairlyActiveMinutes) %>%
  mutate(ActivityLevel = case_when(
    TotalActiveMinutes == 0 ~ "NoActive",
    TotalActiveMinutes < 30 ~ "FairlyActive",
    TotalActiveMinutes >= 30 ~ "Active"
  ))

# Count the combination of SleepCategory and ActivityLevel
sleep_activity_counts <- merged_data %>%
  group_by(SleepCategory, ActivityLevel) %>%
  summarise(count = n(), .groups = 'drop')

# Calculate percentages for the plot
total_counts <- sleep_activity_counts %>%
  group_by(SleepCategory) %>%
  summarise(total = sum(count))

sleep_activity_counts <- sleep_activity_counts %>%
  left_join(total_counts, by = "SleepCategory") %>%
  mutate(percentage = (count / total) * 100)

# Reorder sleep categories
sleep_activity_counts$SleepCategory <- factor(sleep_activity_counts$SleepCategory, 
                                              levels = c("Insufficient Sleep", "Adequate Sleep", "Excessive Sleep"))

# Create the plot with side-by-side bars and color palette for colorblind accessibility
ggplot(sleep_activity_counts, aes(x=SleepCategory, y=percentage, fill=ActivityLevel)) +
  geom_bar(stat="identity", position=position_dodge()) +
  geom_text(aes(label=paste0(sprintf("%.1f", percentage), "%")), 
            position=position_dodge(width=0.9), vjust=-0.5, size=3, color="black") +
  labs(title="Distribution of Activity Levels by Sleep Categories",
       x="Sleep Category",
       y="Proportion",
       fill="Activity Level") +
  theme_minimal() +
  scale_fill_viridis_d() +
  scale_y_continuous(labels = scales::percent_format(scale = 1))

```

### Summary of the Graph

The graph displays the distribution of activity levels (Active, FairlyActive, NoActive) across different sleep categories (Insufficient Sleep, Adequate Sleep, Excessive Sleep). It highlights the predominance of inactive individuals among those with insufficient sleep and a more balanced activity distribution in individuals with adequate sleep. This insight suggests targeted marketing strategies to promote better sleep and activity habits using Bellabeat products.

#### References:

1.  National Sleep Foundation. ["How Much Sleep Do We Really Need?"](https://www.sleepfoundation.org/how-sleep-works/how-much-sleep-do-we-really-need). Accessed on July 8, 2024.

2.  Centers for Disease Control and Prevention (CDC). ["Sleep and Sleep Disorders"](https://www.cdc.gov/sleep/about_sleep/how_much_sleep.html). Accessed on July 8, 2024.

## Hourly Analysis of Average Physical Activity Intensity

#### Objective:

The goal of this analysis is to visualize the average total intensity of physical activity throughout the day. By plotting the intensity levels against time, we aim to identify patterns and peak periods of activity among users, providing insights into daily activity routines.

```{r}
# Calculate the mean total intensity per time
int_new <- intensities %>%
  group_by(time) %>%
  summarise(mean_total_int = mean(TotalIntensity, na.rm = TRUE))

# Convert time to POSIXct for proper plotting
int_new$time <- as.POSIXct(int_new$time, format="%H:%M:%S")

# Create a line plot
ggplot(data=int_new, aes(x=time, y=mean_total_int, group=1)) + 
  geom_line(color='darkblue') +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title="Average Total Intensity vs. Time",
       x="Time",
       y="Average Total Intensity") +
  scale_x_datetime(date_labels = "%H:%M", date_breaks = "1 hour")
```

### Findings:

The line graph shows the variation in average total intensity over a 24-hour period. It reveals a clear pattern of activity, with intensity increasing throughout the morning, peaking in the late afternoon and early evening, and then gradually declining towards the night. The peak periods of activity, particularly around 5 PM to 7 PM, coincide with typical times when people finish their workday and engage in physical activities. This correlation suggests that Bellabeat users are more active after work hours, highlighting the importance of promoting evening exercise routines and potentially developing features or content to support post-workday activities. This information helps Bellabeat tailor its marketing strategies and product features to better align with user behavior.

## Heartrate

### Introduction

In this analysis, we will explore the heart rate (Value) data through two main visualizations: a histogram and a boxplot. These visualizations will help us understand the general distribution, central tendency, variability, and presence of outliers in the heart rate data.

### Histogram

```{r}
ggplot(heartrate, aes(x = Value)) +
  geom_histogram(binwidth = 1, fill = "blue", color = "black") +
  labs(title = "Histogram of Values", x = "Value", y = "Frequency")

```

The histogram shows the frequency of heart rate values (Value).

#### Overall Distribution:

The majority of heart rate values are concentrated between approximately 60 and 100 beats per minute (bpm). The distribution appears to have a main peak around 70-80 bpm, indicating that this is the most common range.

#### Extreme Values:

There are values extending above 100 bpm, up to the maximum observed value of 203 bpm, but these are less frequent. There are few values below 60 bpm.

### Boxplot

```{r}
ggplot(heartrate, aes(y = Value)) +
  geom_boxplot(fill = "blue", color = "black") +
  labs(title = "Boxplot of Values", y = "Value")

```

The boxplot provides a clear view of quartiles, the median, and potential outliers.

#### Quartiles:

-   The first quartile (Q1) is at 63 bpm, meaning 25% of the data is below this value. The third quartile (Q3) is at 88 bpm, meaning 75% of the data is below this value.

#### Median:

-   The median is 73 bpm, representing the central value of the data. Half of the data is below and half above this value.

#### Outliers:

-   There are values considered outliers above approximately 150 bpm. These are points that are significantly distant from the rest of the data and could be special cases or measurement errors.

### General Conclusions

#### Normality and Concentration:

-   The heart rate data is primarily concentrated between 60 and 100 bpm, with a peak around 70-80 bpm, suggesting that most heart rate measurements fall within the normal range for resting adults.

#### Presence of Outliers:

-   There are significant outliers above 150 bpm. These could be due to intense physical activity, stressful situations, or measurement errors. It would be useful to investigate these outliers to better understand their origin.

#### Data Variability:

-   The standard deviation of 19.40 indicates some variability in the data, but most values still fall within a reasonable range.

### Recommended Actions

#### Investigate Outliers:

-   Analyze the outliers to determine if they are valid values or measurement errors. If they are errors, consider addressing them during data cleaning.

#### Monitor Health:

-   The concentration of heart rates between 60 and 100 bpm is a good indicator of a healthy group, but extreme values should be monitored in context.

# 6- Act

## Detailed Insights for Bellabeat

### Importance of Regular Physical Activity

-   With almost 40% of days being inactive, there is a significant opportunity to encourage daily physical activity, especially for users who are completely sedentary on many days. This aligns with Bellabeat's mission to promote wellness among women.

### Market Segmentation

-   **Active Group**: These users are already engaged in regular physical activities. Marketing strategies can focus on products that enhance performance or recovery, such as the **Time** (smartwatch) and the **Leaf** (wellness tracker), offering detailed and personalized insights to optimize their routine.
-   **Moderately Active Group**: This group can be motivated to increase their physical activity level. Offers such as fitness challenges, progressive training programs, and incentives to reach physical activity goals can be effective. Products like the **Spring** (smart water bottle) can be promoted to maintain hydration during activities.
-   **Inactive Group**: This group needs more motivation and support to start physical activities. Strategies can include beginner exercise programs, personalized coaching through the **Bellabeat App**, and rewards for small milestones achieved. The **Bellabeat Membership** can provide additional support with personalized guidance.

### Opportunities for Intervention

-   **Education and Awareness**: Educational campaigns about the benefits of regular physical activity and how to incorporate it into daily routines, using the **Bellabeat App** to provide personalized tips and reminders.
-   **Community Programs**: Developing community-based physical activity programs, such as group walks, outdoor fitness classes, and local sports events, encouraging the use of the **Leaf** and **Time**.
-   **Technology and Tools**: Investing in technology that helps monitor and encourage physical activity, such as updates to the **Bellabeat App** that incorporate gamification and rewards for achieving goals.

## Marketing Strategy for Bellabeat

### Personalized Campaigns

-   **Active**: Promote products and services that help optimize performance, such as advanced training, high-performance equipment, and nutritional supplements. Highlight integration with the **Bellabeat App** for detailed performance analysis.
-   **Moderately Active**: Offer programs that encourage progress, such as training plans with gradual goals, fitness challenges, and progress monitoring. Utilize the **Bellabeat Membership** to offer continuous support.
-   **Inactive**: Launch motivational campaigns that demonstrate the benefits of small changes, like daily walks, and provide resources to start, such as simple exercise tutorials on the **Bellabeat App**.

### Use of Influencers and Testimonials

-   Use fitness and wellness influencers to share their routines and how they overcame inactivity. Success stories can be powerful in motivating those reluctant to start an exercise routine.

### Promotions and Incentives

-   Offer discounts on Bellabeat products, such as the **Leaf**, **Time**, and **Spring**, as well as subscriptions to the **Bellabeat Membership**. Create a rewards system for users who achieve their physical activity goals, promoting continuous use of the devices.

### Strategic Partnerships

-   Form partnerships with gyms, personal trainers, and nutritionists to offer service packages that meet the needs of each physical activity group. Integrate these services with the **Bellabeat App** for comprehensive tracking.

### Engagement Platforms

-   Develop a digital platform where users can log their physical activity, participate in challenges, receive personalized tips, and track their progress. Include gamification elements in the **Bellabeat App** to increase engagement.

## Conclusion

Based on the analyzed data, there is a significant opportunity to encourage physical activity among inactive and moderately active users. Targeted and personalized marketing strategies can help motivate these groups to become more active, while those who are already active can be encouraged to optimize and maintain their performance. Investing in education, resources, and incentives is crucial to promoting a healthier and more active lifestyle among all Bellabeat users.

### Limitations of the Analysis

-   Reliability
-   Personal characteristics of the users
-   Gender of the users

**Personal Note:** First, I want to thank everyone who reviewed my first data analysis project. I hope you enjoyed it, and I would be even more grateful if you could provide me with some feedback and suggestions for improvement. I also want to mention that I drew inspiration from some existing projects (which helped me get unstuck), YouTube, and our new personal ally, ChatGPT.

Thank you!
